<h2 style="text-align:center;margin:0em 1em 1em 0em"><%= @event.name %></h2>
<div id="flash-message" class="row-fluid"></div>
<div class="row-fluid">
	<div class="span4">
		<div>
			<span style="font-weight:bold;font-size:14px">Host: </span>
			<span style="font-size:14px"><%= @event.user.full_name %></span>
		</div>
		<div>
			<span style="font-weight:bold;font-size:14px">Host Email: </span>
			<span style="font-size:14px"><%= @event.user.email %></span>
		</div>
		<div>
			<span style="font-weight:bold;font-size:14px">Start Date: </span>
			<span style="font-size:14px"><%= @event.display_start_time %></span>
		</div>
		<div>
			<span style="font-weight:bold;font-size:14px">RSVP Date: </span>
			<span style="font-size:14px"><%= @event.display_rsvp_time %></span>
		<div style="font-size:14px;margin-top:1em;"><%= @event.rsvp_countdown %></div>
		<div style="margin-top:1em"><span style="font-size:14px;font-weight:bold;">Number of guest attending: </span><%= @event.attending_guest_count %></div>
		<div style="margin-top:1em">
		<%= link_to 'Back', events_path, :class=>"btn btn-link" %></div>
	</div>
</div>
	<div class="span3">
	<span style="font-weight:bold;font-size:14px">Event Location: </span>
	<% if @event.location %>
		<%= @event.location1 %><br />
		<%= @event.location2 %>
	<% end %>
</div>
	<div class="span4">
		<span style="font-weight:bold;font-size:14px;">Need to know info from the host:</span>
		<% if @event.supplemental_info %>
			<%= @event.supplemental_info %>
		<% else %>
			<%= "Undecided" %>
		<% end %>
	</div>
</div>
<div class="row-fluid">
	<div class="span6 offset2">You are currently <span id='text-rsvp'><%= @attendee.rsvp %></span>
	</div>
	<div class="span9">
		<input type="text" class="btn btn-success" id="going-button" value="Going" onclick="rsvp('Going',<%= @attendee.id %>)" />
		<input type="text" class="btn btn-danger" id="not-going-button" value="Not Going" onclick="rsvp('Not Going', <%= @attendee.id %>)" />
		<input type="text" class="btn btn-warning" id="undecided-button" value="Undecided" onclick="rsvp('Undecided', <%= @attendee.id %>)" />
		<div id="comment-box">
			<input type="hidden" id="attendee-id" value="<%= @attendee.id %>" ><br />
			<input type="hidden" id="attendee-rsvp" value="<%= @attendee.rsvp %>" ><br />
			<label for="attendee-comment">Comments?</label>
			<input type="text" id="attendee-comment" value="<%= @attendee.comment %>" ><br/>
			<div id="guestcount_div">
				<label for="attendee-guestcount">Number of guests you are bringing (excluding yourself):</label>
				<input type="text" id="attendee-guestcount" value="<%= @attendee.num_of_guests %>" ><br/>
			</div>
			<button id="cancel" class="btn">Cancel</button>
			<button id="submit" class="btn btn-primary">Update</button>
		</div>
	</div>
</div>
<script type="text/javascript">
		function rsvp(answer, id){
			$("#attendee-rsvp").val(answer);
			$("#comment-box").show();
			if (answer == "Going")
				$("#guestcount_div").show();
		}

		$(document).ready(function(){
			$("#guestcount_div").hide();
			$("#comment-box").hide();

			$("#cancel").click(function(){
					$("#guestcount_div").hide();
					$("#comment-box").hide();
			});

			$("#submit").click(function(){
				var attendee_id = $("#attendee-id").val();
				var attendee_comment = $("#attendee-comment").val();
				var attendee_rsvp = $("#attendee-rsvp").val();
				var attendee_guestcount = $("#attendee-guestcount").val();
					if (attendee_rsvp != "Going")
						attendee_guestcount = 0;
				var attendeeJson = { id: attendee_id, comment: attendee_comment, rsvp: attendee_rsvp, num_of_guests: attendee_guestcount };

			$("#flash-message").addClass("alert");
			$.ajax({
					url: window.location.pathname+"/attendees/"+attendee_id,
					beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
					dataType: "json",
					data: "attendee="+JSON.stringify(attendeeJson),
					type: "PUT",
					
					error: function(object, textStatus, errorThrown){
						$("#flash-message").removeClass("alert-success");
						$("#flash-message").addClass("alert-error");
						$("#flash-message").text("There was something wrong with your RSVP. It couldn't update successfully");
					},
					success: function(){
						$("#flash-message").removeClass("alert-error");
						$("#flash-message").addClass("alert-success");
						$("#flash-message").text("Your RSVP has been submitted successfully");
						$("#text-rsvp").text(attendee_rsvp);
						$("#comment-box").hide();
					}
			});
			});
		});

</script>
