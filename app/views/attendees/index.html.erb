<table class="table table-condensed">
	<thead>
		<tr>
			<th>Name</th>
			<th>Email address</th>
			<th>RSVP</th>
			<th>Options</th>
		</tr>
	</thead>

	<tbody>
<% @event.attendees.each do |attendee| %>
  <tr id="guest_<%= attendee.id %>">
		<td><%= attendee.full_name %></td>
		<td><%= attendee.email %></td>
		<td style="text-align:center"><%= attendee.rsvp %></td>
		<td><span class="btn btn-success"><%= link_to 'Edit', edit_event_attendee_url(@event, attendee), { :style => "color:white", :class=>"editAttendee"} %></span><span class="btn btn-danger"><%= link_to 'Remove', event_attendee_url(@event, attendee), { confirm: 'Are you sure?', method: :delete, :style=>"color:white", :class=>"removeAttendee"} %></span></td>
  </tr>
<% end %>
	</tbody>
</table>

<br />
<button href="#newAttendeeModal" id="newAttendeeButton" class="btn btn-primary" data-toggle="modal">New Guest</button>
<script>
	$(document).ready(function(){

		$("#newAttendeeButton").click(function(){
			var url = document.location.pathname+"/attendees/new", newAttendeeModal = $("#newAttendeeModal");
			$.ajax({
				url: url,
				dataType: "html",
				success: function(data){
					newAttendeeModal.find(".modal-body").html(data);
					newAttendeeModal.modal("show");
				},
				error: function(xhr, errorText, errorObject){
					newAttendeeModal.find(".modal-body").html("<div class='alert alert-error'>"+errorText+": Cannot retrieve form for new guest. Please contact the administrator about this</div>");
				}
			});
		});

		$(".removeAttendee").click(function(){
			var url = $(this).attr('href');
			var id = url.substr(url.lastIndexOf("/")+1);
			var table_row_id = "guest_"+id;
			$.ajax({
				url: url,
				dataType: "html",
				data: id,
				type: "DELETE",
				async: false,
				success: function(){
					$("#notice").removeClass("alert alert-error alert-success").addClass("alert alert-success");
					$("#notice").html("Guest has been removed from your event");
					$("#"+table_row_id).remove();
				},
				error: function(){
					$("#notice").removeClass("alert alert-error alert-success").addClass("alert alert-error");
					$("#notice").html("Guest cannot be removed from the event");
				}
			});
			return false;
		});

		$(".editAttendee").click(function(){
			var editAttendeePath = $(this).attr("href"), editAttendeeModal = $("#editAttendeeModal"), url;

			//initialize the modal
			url = editAttendeePath.match(/\/events.+/);
			$("#editAttendeeModal").attr("data-remote", url);
			$.ajax({
				url: url,
				dataType: "html",
				success: function(data){
					editAttendeeModal.find(".modal-body").html(data);
					editAttendeeModal.modal("show");
				},
				error: function(xhr, errorText, errorObject){
					editAttendeeModal.find(".modal-body").html("<div class='alert alert-error'>"+errorText+": Cannot retrieve information for guest. Please contact the administrator about this</div>");
				}
			});
			return false;
		});
	});
</script>
